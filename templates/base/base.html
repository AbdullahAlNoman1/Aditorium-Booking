<!DOCTYPE html>
<html lang="en"> {% load static %}
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}{% endblock %}</title>

        <!-- <link rel="shortcut icon" type="image/x-icon" href="{% static 'assets/images/favicon.ico' %}"> -->

        <!-- <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet"> -->

        <link href="{% static 'assets/css/bootstrap.min.css' %}" rel="stylesheet">
        <link href="{% static 'assets/fontawesome/css/fontawesome-all.css' %}" rel="stylesheet">
        <link href="{% static 'assets/fontello/css/fontello.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/wedding-icon-font/flaticon.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/owl.carousel.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/owl.theme.default.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/dzsparallaxer.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/jquery-ui.min.css' %}" rel="stylesheet">
        <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">
        <style>
          .header-transparent {
              top: 0;
          }
          .page-header {
              background-size: cover!important;
              background-position: center!important;
              background-repeat: no-repeat!important;
          }

          .pagination .page-item .page-link.disabled {
            cursor: not-allowed;
            opacity: .5;
          }

          .vendor-form{
            padding: 120px 0;
          }
          .nice-select{
            float: none;
          }
          button.btn-sm{
            font-size: 14px;
          }
        </style>

        <!-- Stripe css -->
        <script src="https://js.stripe.com/v3/"></script>
        <style>
            .StripeElement {
                box-sizing: border-box;
                height: 40px;
                padding: 10px 12px;
                border: 1px solid transparent;
                border-radius: 4px;
                background-color: white;
                box-shadow: 0 1px 3px 0 #e6ebf1;
                -webkit-transition: box-shadow 150ms ease;
                transition: box-shadow 150ms ease;
            }
            .StripeElement--focus {
                box-shadow: 0 1px 3px 0 #cfd7df;
            }
            .StripeElement--invalid {
                border-color: #fa755a;
            }
            .StripeElement--webkit-autofill {
                background-color: #fefde5 !important;
            }
        </style>
        {% block css %}
        {% endblock %}
    </head>

    <body>
        {% block header %}
        {% endblock %}

        {% block breadcrumb %}
        {% endblock %}

        {% block banner %}
        {% endblock %}

        {% block content %}
        {% endblock %}

        {% block footer %}
        {% endblock %}
        <a href="javascript:void(0)" id="return-to-top"><i class="fa fa-angle-up"></i></a>

        <script src="{% static 'assets/js/jquery.min.js' %}"></script>
        <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
    
        <script src="{% static 'assets/js/owl.carousel.min.js' %}"></script>
        <script src="{% static 'assets/js/jquery.nice-select.min.js' %}"></script>
        <script src="{% static 'assets/js/fastclick.js' %}"></script>
        <script src="{% static 'assets/js/custom-script.js' %}"></script>
        <script src="{% static 'assets/js/return-to-top.js' %}"></script>
        <script src="{% static 'assets/js/dzsparallaxer.js' %}"></script>
        <script src="{% static 'assets/js/jquery-ui.min.js' %}"></script>
        <script>
            $(document).ready(function(){
                // using jQuery
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                var csrftoken = getCookie('csrftoken');

                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }
                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });
            });
        </script>
        <script>
          (function ($) {
              $('[data-bg-image]').each(function () {
                var img = $(this).data('bg-image');
                $(this).css({
                  background: 'url(' + img + ')'
                });
              });
              var dateInput = $('#id_booking_date');

              dateInput.attr("autocomplete","off");
              dateInput.datepicker();
          })(jQuery);
        </script>
        <!-- Stripe -->
        <script>
            var paymentForm = $('#payment-form');
            if (paymentForm.length > 1){
                alert('Multiple Payment form Found')
                paymentForm.css('display', 'none')
            } else if (paymentForm.length == 1) {
                public_key = paymentForm.attr('data-token')
            }

            // Create a Stripe client.
            var stripe = Stripe(public_key);

            // Create an instance of Elements.
            var elements = stripe.elements();

            // Custom styling can be passed to options when creating an Element.
            // (Note that this demo uses a wider set of styles than the guide below.)
            var style = {
                base: {
                    color: '#32325d',
                    fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
                    fontSmoothing: 'antialiased',
                    fontSize: '16px',
                    '::placeholder': {
                        color: '#aab7c4'
                    }
                },
                invalid: {
                    color: '#fa755a',
                    iconColor: '#fa755a'
                }
            };

            // Create an instance of the card Element.
            var card = elements.create('card', {style: style});

            // Add an instance of the card Element into the `card-element` <div>.
            card.mount('#card-element');

            // Handle real-time validation errors from the card Element.
            card.addEventListener('change', function(event) {
            var displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
            } else {
                displayError.textContent = '';
            }
            });

            // Handle form submission.
            var form = document.getElementById('payment-form');
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                stripe.createToken(card).then(function(result) {
                    if (result.error) {
                    // Inform the user if there was an error.
                    var errorElement = document.getElementById('card-errors');
                        errorElement.textContent = result.error.message;
                    } else {
                    // Send the token to your server.
                        stripeTokenHandler(result.token);
                    }
                });
            });

            // Submit the form with the token ID.
            function stripeTokenHandler(token) {

                /* console.log(token.id) */ 
                /* Insert the token ID into the form so it gets submitted to the server */
                var form = document.getElementById('payment-form');
                var hiddenInput = document.createElement('input');
                hiddenInput.setAttribute('type', 'hidden');
                hiddenInput.setAttribute('name', 'stripeToken');
                hiddenInput.setAttribute('value', token.id);
                form.appendChild(hiddenInput);
                console.log(hiddenInput)
                /* Submit the form */
                // form.submit();

                console.log(token.id)
                var cardMethodEndpoint = '{{ api_end_url }}'
                var data = {
                    "token": token.id
                }
                $.ajax({
                    url: cardMethodEndpoint,
                    method: "POST",
                    data: data,
                    success: function(data) {
                        console.log("success from ajax js", data)
                    },
                    error: function(error) {
                        console.log("error from ajax js", error)
                    }
                });
            }
        </script>
        {% block js %}
        {% endblock %}
    </body>
</html>